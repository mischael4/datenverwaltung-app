<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Datenverwaltung - Bereichslehrkräfte Köln</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; background: #fafafa; }
    h2, h4, label { font-size: 16px; font-weight: 600; color: #222; }
    .container { display: flex; flex-direction: column; gap: 20px; }
    .form-container, .table-container { background: #fff; border: 1px solid #ccc; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,.05); }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    label .hint { font-size: 12px; font-weight: normal; color: #666; }
    input, textarea, select, button { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; }
    button { background: #27ae60; color: #fff; border: none; border-radius: 8px; cursor: pointer; }
    button:hover { background: #1f8a4e; }
    .btn-secondary { background: #e9ecef; color: #222; }
    .btn-secondary:hover { background: #dde1e6; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 14px; }
    th { background: #f2f2f2; }
    tr:nth-child(even) { background: #f9f9f9; }
    .summary { margin-top: 10px; font-weight: bold; text-align: right; }
    .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 20px; border: 1px solid #ccc; border-radius: 10px; z-index: 1000; width: min(600px,92vw); max-height: 90vh; overflow: auto; }
    #tatigkeit { height: 240px; font-size: 14px; line-height: 1.4; }
    #tatigkeit option { padding: 4px 6px; border-bottom: 1px solid #eee; }
    #tatigkeit option:last-child { border-bottom: none; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Datenverwaltung - Bereichslehrkräfte Köln</h2>
    <div class="form-container">
      <h4>Neuen Datensatz hinzufügen</h4>
      <form id="dataForm">
        <div class="form-group"><label for="datum">Datum:</label><input type="date" id="datum" name="datum" required></div>
        <div class="form-group"><label for="name">Name:</label><input type="text" id="name" name="name" required></div>
        <div class="form-group"><label for="schule">Ort der Beschulung/ Besprechung:</label><input type="text" id="schule" name="schule" required></div>
        <div class="form-group"><label for="tatigkeit">Unterstützungsmaßnahmen <span class="hint">(Mehrfachauswahl mit STRG (Windows) oder CMD (Mac))</span></label><select id="tatigkeit" name="tatigkeit" multiple required>
          <option>Förderunterricht</option><option>Anmeldung durchreisender SchülerInnen an örtlichen Stammschulen</option><option>Beratung von Bereichslehrkräften</option><option>Beratung einer Stamm- oder Stützpunktschule</option><option>Beratung von Eltern, Kindern und Schulen</option><option>Beratung von Lehrkräften</option><option>Beratung zur schulischen Perspektive</option><option>Datenerfassung DigLu - Anmeldung, Aktualisierung, Pflege und Registrierung</option><option>Dienstbesprechung bei der Bezirksregierung</option><option>Dienstbesprechung</option><option>Dokumentation</option><option>Entwicklung und Mitwirkung an innovativen Unterrichtsverfahren</option><option>geregelte Übergabe von SchülerInnen an andere Schulen und Bereichslehrkräfte</option><option>Herstellung von Kontakten zwischen Eltern und Schulen</option><option>Kontrolle der Lernstandsberichte, Einträge Schultagebuch (DigLu)</option><option>Organisation von Medien und Unterrichtsmaterialien für den Online-Unterricht</option><option>Organisation von Medien und Unterrichtsmaterialien für die Reise</option><option>Sammlung und Entwicklung von Unterrichtsmaterial</option><option>Sprechstundenbereitschaft</option><option>Teilnahme an der BuFo für BLK</option><option>Teilnahme BLK Landestreffen</option><option>terminliche Koordination</option><option>Unterstützung von SchülerInnen bei der Vorbereitung auf zentrale Prüfungen</option><option>Vorbereitung der Stützpunktschulen auf den Schulbesuch</option><option>besondere Koordinatorentätigkeiten</option><option>sonstiges</option><option>erkrankt</option>
        </select></div>
        <div class="form-group"><label for="anmerkungen">Anmerkungen:</label><textarea id="anmerkungen" name="anmerkungen" rows="3"></textarea></div>
        <div class="form-group"><label for="zeit">Zeit (in Stunden):</label><input type="number" id="zeit" name="zeit" step="0.1" required></div>
        <div class="form-group"><label for="km">Kilometer (km):</label><input type="number" id="km" name="km" step="0.1" required></div>
        <button type="submit">Datensatz hinzufügen</button>
      </form>
    </div>
    <div class="table-container">
      <h2>Datensätze</h2>
      <table id="dataTable"><thead><tr><th>Datum</th><th>Name</th><th>Ort</th><th>Unterstützungsmaßnahmen</th><th>Anmerkungen</th><th>Zeit (h)</th><th>Kilometer</th><th>Aktion</th></tr></thead><tbody id="tableBody"></tbody></table>
      <div id="summenAnzeige" class="summary"></div>
      <button id="openExportDialogZeit">Als PDF exportieren (Tätigkeitsbericht)</button>
      <button id="openExportDialogKm">Als PDF exportieren (Fahrtkostenabrechnung)</button>
    </div>
  </div>

  <div id="exportDialogZeit" class="modal">
    <h2>Exportieren (Tätigkeitsbericht)</h2>
    <form id="exportFormZeit"><div class="form-group"><label for="monatZeit">Monat:</label><input type="text" id="monatZeit" name="monatZeit" required></div>
      <div class="form-group"><label for="datumZeit">Datum:</label><input type="date" id="datumZeit" name="datumZeit" required></div>
      <div class="form-group"><label for="bereichslehrkraftZeit">Bereichslehrkraft:</label><input type="text" id="bereichslehrkraftZeit" name="bereichslehrkraftZeit" required></div>
      <div class="form-group"><button type="button" id="exportPdfZeit">Exportieren</button><button type="button" id="cancelExportZeit" class="btn-secondary">Abbrechen</button></div>
    </form>
  </div>

  <div id="exportDialogKm" class="modal">
    <h2>Exportieren (Fahrtkostenabrechnung)</h2>
    <form id="exportFormKm"><div class="form-group"><label for="monatKm">Monat:</label><input type="text" id="monatKm" name="monatKm" required></div>
      <div class="form-group"><label for="datumKm">Datum:</label><input type="date" id="datumKm" name="datumKm" required></div>
      <div class="form-group"><label for="bereichslehrkraftKm">Bereichslehrkraft:</label><input type="text" id="bereichslehrkraftKm" name="bereichslehrkraftKm" required></div>
      <div class="form-group"><button type="button" id="exportPdfKm">Exportieren</button><button type="button" id="cancelExportKm" class="btn-secondary">Abbrechen</button></div>
    </form>
  </div>

  <script>
    function pad2(n){ return String(n).padStart(2,'0'); }
    function isoToGerman(iso){ const p=(iso||'').split('-'); return p.length===3?`${p[2]}.${p[1]}.${p[0]}`:iso; }
    function toGermanDateGuess(s){ const t=(s||'').trim(); if(t.includes('-')){const p=t.split('-'); if(p.length===3) return `${pad2(p[2])}.${pad2(p[1])}.${p[0]}`;} if(t.includes('.')){const p=t.split('.'); if(p.length===3){let y=p[2]; if(y.length===2) y=Number(y)>=70?'19'+y:'20'+y; return `${pad2(p[0])}.${pad2(p[1])}.${y}`;}} return t; }
    function exportCommon(doc, meta){ doc.setFontSize(14); doc.text(meta.titel,14,14); doc.setFontSize(11); doc.text(`Monat: ${meta.monat||''}`,14,22); doc.text(`Datum: ${isoToGerman(meta.datumISO||'')}`,14,29); doc.text(`Bereichslehrkraft: ${meta.lehrkraft||''}`,14,36); doc.autoTable({html:'#dataTable',startY:44,didParseCell:data=>{if(data.section==='body'&&data.column.index===0){const orig=Array.isArray(data.cell.text)?data.cell.text.join(' '):String(data.cell.text||''); data.cell.text=[toGermanDateGuess(orig)];}}}); }
    document.getElementById('exportPdfZeit').addEventListener('click',()=>{const{jsPDF}=window.jspdf;const doc=new jsPDF();exportCommon(doc,{titel:'Berichtsdokument für Bereichslehrkräfte für reisende Kinder und Jugendliche',monat:document.getElementById('monatZeit').value,datumISO:document.getElementById('datumZeit').value,lehrkraft:document.getElementById('bereichslehrkraftZeit').value});doc.save('taetigkeitsbericht.pdf');});
    document.getElementById('exportPdfKm').addEventListener('click',()=>{const{jsPDF}=window.jspdf;const doc=new jsPDF();exportCommon(doc,{titel:'Fahrtkostenabrechnung Bereichslehrkräfte',monat:document.getElementById('monatKm').value,datumISO:document.getElementById('datumKm').value,lehrkraft:document.getElementById('bereichslehrkraftKm').value});doc.save('fahrtkosten.pdf');});
  </script>
</body>
</html>
