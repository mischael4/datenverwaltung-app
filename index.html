<!DOCTYPE html> 
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Datensatzverwaltung" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#27ae60" />
  <meta name="touch-action" content="manipulation" />
  <link rel="manifest" href="manifest.json" />

  <title>Datenverwaltung - Bereichslehrkräfte Köln</title>

  <!-- PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <!-- Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <link id="favicon" rel="icon" type="image/png" href="icon-192.png">
  <link id="appleIcon" rel="apple-touch-icon" href="icon-512.png">

  <style>
    :root { --brand:#27ae60; --brand-d:#1f8a4e; }
    body { font-family:Arial,sans-serif; margin:20px; }
    h2,h4,label { font-size:15px; font-weight:600; color:#222; }
    .container { display:flex; flex-direction:column; gap:20px; }
    .form-container,.table-container {
      border:1px solid #ccc; padding:20px; border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
    }
    .form-group { margin-bottom:15px; }
    label { display:block; margin-bottom:5px; }
    label .hint { font-size:12px; font-weight:normal; color:#666; display:block; margin-top:2px; }
    input,textarea,select {
      width:100%; padding:10px; box-sizing:border-box;
      border:1px solid #ccc; border-radius:6px;
    }
    button {
      background:var(--brand); color:white; padding:10px 15px;
      border:none; border-radius:8px; cursor:pointer; font-size:16px;
      margin:4px 2px;
    }
    button:hover { background:var(--brand-d); }
    .btn-secondary { background:#e9ecef; color:#222; }
    .btn-secondary:hover { background:#dde1e6; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th,td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#f2f2f2; }
    tr:nth-child(even){ background:#f9f9f9; }
    .summary { margin-top:10px; font-weight:bold; text-align:right; }
    .delete-btn { background:#e74c3c; }
    .delete-btn:hover { background:#c0392b; }
    .edit-btn { background:#f39c12; }
    .edit-btn:hover { background:#d68910; }
    .modal {
      display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:whitesmoke; padding:20px; border:1px solid #ccc; border-radius:10px;
      z-index:1000; width:min(700px,92vw); max-height:90vh; overflow:auto;
    }
    @media (max-width:768px) {
      body { margin:10px; font-size:16px; }
      .form-container,.table-container { padding:15px; }
      input,textarea,button { font-size:16px; }
      button { width:100%; padding:14px; font-size:18px; }
      table { display:block; overflow-x:auto; white-space:nowrap; }
      th,td { font-size:14px; padding:6px; }
    }
    #tatigkeit { height:260px; font-size:13px; line-height:1.4; padding:6px; }
    #tatigkeit option { padding:4px 6px; border-bottom:1px solid #eee; }
    #tatigkeit option:last-child { border-bottom:none; }
  </style>
</head>

<body>
<div class="container">
  <h2>Datenverwaltung - Bereichslehrkräfte Köln</h2>

  <!-- Formular -->
  <div class="form-container">
    <h4>Neuen Datensatz hinzufügen</h4>
    <form id="dataForm">
      <div class="form-group"><label for="datum">Datum:</label><input type="date" id="datum" required></div>
      <div class="form-group"><label for="name">Name:</label><input type="text" id="name" required></div>
      <div class="form-group"><label for="schule">Ort der Beschulung/ Besprechung:</label><input type="text" id="schule" required></div>
      <div class="form-group">
        <label for="tatigkeit">Unterstützungsmaßnahmen <span class="hint">(Mehrfachauswahl mit STRG/CMD)</span></label>
        <select id="tatigkeit" multiple required>
          <option>Förderunterricht</option>
          <option>Anmeldung durchreisender SchülerInnen an örtlichen Stammschulen</option>
          <option>Beratung von Bereichslehrkräften</option>
          <option>Beratung einer Stamm- oder Stützpunktschule</option>
          <option>Beratung von Eltern, Kindern und Schulen</option>
          <option>Beratung von Lehrkräften</option>
          <option>Beratung zur schulischen Perspektive</option>
          <option>Datenerfassung DigLu - Anmeldung, Aktualisierung, Pflege und Registrierung</option>
          <option>Dienstbesprechung bei der Bezirksregierung</option>
          <option>Dienstbesprechung</option>
          <option>Dokumentation</option>
          <option>Entwicklung und Mitwirkung an innovativen Unterrichtsverfahren</option>
          <option>geregelte Übergabe von SchülerInnen an andere Schulen und Bereichslehrkräfte</option>
          <option>Herstellung von Kontakten zwischen Eltern und Schulen</option>
          <option>Kontrolle der Lernstandsberichte, Einträge Schultagebuch (DigLu)</option>
          <option>Organisation von Medien und Unterrichtsmaterialien für den Online-Unterricht</option>
          <option>Organisation von Medien und Unterrichtsmaterialien für die Reise</option>
          <option>Sammlung und Entwicklung von Unterrichtsmaterial</option>
          <option>Sprechstundenbereitschaft</option>
          <option>Teilnahme an der BuFo für BLK</option>
          <option>Teilnahme BLK Landestreffen</option>
          <option>terminliche Koordination</option>
          <option>Unterstützung von SchülerInnen bei der Vorbereitung auf zentrale Prüfungen</option>
          <option>Vorbereitung der Stützpunktschulen auf den Schulbesuch</option>
          <option>besondere Koordinatorentätigkeiten</option>
          <option>sonstiges</option>
          <option>erkrankt</option>
        </select>
      </div>
      <div class="form-group"><label for="anmerkungen">Anmerkungen:</label><textarea id="anmerkungen" rows="3"></textarea></div>
      <div class="form-group"><label for="zeit">Zeit (h):</label><input type="number" id="zeit" step="0.1" required></div>
      <div class="form-group"><label for="km">Kilometer (km):</label><input type="number" id="km" step="0.1" required></div>
      <button type="submit" id="submitBtn">Datensatz hinzufügen</button>
    </form>
  </div>

  <!-- Tabelle -->
  <div class="table-container">
    <h2>Datensätze</h2>
    <table><thead>
      <tr><th>Datum</th><th>Name</th><th>Ort</th><th>Unterstützungsmaßnahmen</th><th>Anmerkungen</th><th>Zeit</th><th>Km</th><th>Aktion</th></tr>
    </thead><tbody id="tableBody"></tbody></table>
    <div id="summenAnzeige" class="summary"></div>
    <button id="openExportDialogZeit">Exportieren (Tätigkeitsbericht)</button><br><br>
    <button id="openExportDialogKm">Exportieren (Fahrtkostenabrechnung)</button><br><br>

    <!-- Neue Buttons -->
    <button id="backupData">Datensätze sichern</button>
    <input type="file" id="restoreFile" style="display:none" />
    <button id="restoreData">Datensätze laden</button>
  </div>
</div>

<!-- Modals -->
<div id="exportDialogZeit" class="modal">
  <!-- unverändert -->
</div>
<div id="exportDialogKm" class="modal">
  <!-- unverändert -->
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const $=id=>document.getElementById(id);
  let dataSets=[];

  function loadData(){ const saved=localStorage.getItem('dataSets'); if(saved){ dataSets=JSON.parse(saved); updateTable(); } }
  function saveData(){ localStorage.setItem('dataSets',JSON.stringify(dataSets)); }
  function formatDateGerman(s){ const d=new Date(s); return `${String(d.getDate()).padStart(2,'0')}.${String(d.getMonth()+1).padStart(2,'0')}.${d.getFullYear()}`; }
  function sumByKey(data,key){ return data.reduce((a,ds)=>a+(+ds[key]||0),0); }

  $('backupData').onclick=()=>{
    const blob=new Blob([JSON.stringify(dataSets,null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="daten.json";
    a.click();
  };

  $('restoreData').onclick=()=>{ $('restoreFile').click(); };
  $('restoreFile').onchange=e=>{
    const file=e.target.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=ev=>{
      try {
        dataSets=JSON.parse(ev.target.result);
        saveData(); updateTable();
        alert("Datensätze erfolgreich geladen!");
      } catch(err){ alert("Fehler beim Laden der Datei."); }
    };
    reader.readAsText(file);
  };

  // (Rest deines Scripts bleibt unverändert: Form handling, updateTable, Exportfunktionen usw.)

  loadData();
});
</script>
</body>
</html>
