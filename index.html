<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Datenverwaltung - Bereichslehrkräfte Köln</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    h2, h3 { margin-top: 20px; }
    button { margin: 5px 0; }
    .dialog {
      display: none;
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 1px solid #aaa;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
    }
  </style>
</head>
<body>
  <h2>Datenverwaltung - Bereichslehrkräfte Köln</h2>

  <form id="dataForm">
    <label>Datum: <input type="date" id="datum" required></label><br>
    <label>Name: <input type="text" id="name" required></label><br>
    <label>Ort: <input type="text" id="schule" required></label><br>
    <label>Unterstützungsmaßnahmen: <input type="text" id="tatigkeit" required></label><br>
    <label>Anmerkungen: <input type="text" id="anmerkungen"></label><br>
    <label>Zeit (h): <input type="number" id="zeit" step="0.1" required></label><br>
    <label>Kilometer: <input type="number" id="km" step="0.1" required></label><br>
    <button type="submit">Speichern</button>
  </form>

  <h3>Gespeicherte Datensätze</h3>
  <table>
    <thead>
      <tr>
        <th>Datum</th><th>Name</th><th>Ort</th><th>Tätigkeit</th><th>Anmerkungen</th><th>Zeit</th><th>KM</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <button id="openDialogZeit">Export: Tätigkeitsbericht</button>
  <button id="openDialogKm">Export: Fahrtkosten</button>

  <!-- Dialog Tätigkeitsbericht -->
  <div class="dialog" id="exportDialogZeit">
    <h3>Export: Tätigkeitsbericht</h3>
    <label>Monat: <input type="text" id="monatZeit" placeholder="z.B. März 2025"></label><br>
    <label>Datum: <input type="date" id="datumZeit"></label><br>
    <label>Bereichslehrkraft: <input type="text" id="bereichslehrkraftZeit"></label><br>
    <button id="exportPdfZeit">PDF erzeugen</button>
    <button onclick="document.getElementById('exportDialogZeit').style.display='none'">Abbrechen</button>
  </div>

  <!-- Dialog Fahrtkosten -->
  <div class="dialog" id="exportDialogKm">
    <h3>Export: Fahrtkosten</h3>
    <label>Monat: <input type="text" id="monatKm" placeholder="z.B. März 2025"></label><br>
    <label>Datum: <input type="date" id="datumKm"></label><br>
    <label>Bereichslehrkraft: <input type="text" id="bereichslehrkraftKm"></label><br>
    <button id="exportPdfKm">PDF erzeugen</button>
    <button onclick="document.getElementById('exportDialogKm').style.display='none'">Abbrechen</button>
  </div>

  <script>
    const form = document.getElementById("dataForm");
    const tableBody = document.getElementById("tableBody");
    let dataSets = [];

    // ---------- Laden & Speichern ----------
    function loadData() {
      const saved = localStorage.getItem("dataSets");
      if (saved) dataSets = JSON.parse(saved);
      renderTable();
    }

    function saveData() {
      localStorage.setItem("dataSets", JSON.stringify(dataSets));
    }

    // ---------- Tabelle ----------
    function renderTable() {
      tableBody.innerHTML = "";
      dataSets.forEach(ds => {
        const row = `<tr>
          <td>${ds.datum}</td>
          <td>${ds.name}</td>
          <td>${ds.schule}</td>
          <td>${ds.tatigkeit}</td>
          <td>${ds.anmerkungen}</td>
          <td>${ds.zeit}</td>
          <td>${ds.km}</td>
        </tr>`;
        tableBody.insertAdjacentHTML("beforeend", row);
      });
    }

    form.addEventListener("submit", e => {
      e.preventDefault();
      const newData = {
        datum: document.getElementById("datum").value,
        name: document.getElementById("name").value,
        schule: document.getElementById("schule").value,
        tatigkeit: document.getElementById("tatigkeit").value,
        anmerkungen: document.getElementById("anmerkungen").value,
        zeit: document.getElementById("zeit").value,
        km: document.getElementById("km").value,
      };
      dataSets.push(newData);
      saveData();
      renderTable();
      form.reset();
    });

    // ---------- Dialog öffnen ----------
    document.getElementById("openDialogZeit").addEventListener("click", () => {
      document.getElementById("exportDialogZeit").style.display = "block";
    });
    document.getElementById("openDialogKm").addEventListener("click", () => {
      document.getElementById("exportDialogKm").style.display = "block";
    });

    // ---------- PDF Export Tätigkeitsbericht ----------
    document.getElementById("exportPdfZeit").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const monat = document.getElementById("monatZeit").value;
      const datum = document.getElementById("datumZeit").value;
      const bereichslehrkraft = document.getElementById("bereichslehrkraftZeit").value;

      doc.setFontSize(14);
      doc.text("Berichtsdokument für Bereichslehrkräfte für reisende Kinder und Jugendliche", 14, 20);
      doc.text(`Monat: ${monat}`, 14, 28);
      doc.text(`Datum: ${datum}`, 14, 36);
      doc.text(`Bereichslehrkraft: ${bereichslehrkraft}`, 14, 44);

      const table = dataSets.map(ds => [ds.datum, ds.name, ds.schule, ds.tatigkeit, ds.zeit]);
      doc.autoTable({
        head: [["Datum", "Name", "Ort", "Tätigkeit", "Zeit (h)"]],
        body: table,
        startY: 54
      });

      const pageWidth = doc.internal.pageSize.getWidth();
      doc.text("Bereichslehrkraft - Unterschrift:", pageWidth / 2, doc.lastAutoTable.finalY + 20, { align: "center" });

      doc.save(`taetigkeitsbericht_${monat}.pdf`);
      document.getElementById("exportDialogZeit").style.display = "none";
    });

    // ---------- PDF Export Fahrtkosten ----------
    document.getElementById("exportPdfKm").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const monat = document.getElementById("monatKm").value;
      const datum = document.getElementById("datumKm").value;
      const bereichslehrkraft = document.getElementById("bereichslehrkraftKm").value;

      doc.setFontSize(14);
      doc.text("Fahrtkostenabrechnung - Bereichslehrkräfte", 14, 20);
      doc.text(`Monat: ${monat}`, 14, 28);
      doc.text(`Datum: ${datum}`, 14, 36);
      doc.text(`Bereichslehrkraft: ${bereichslehrkraft}`, 14, 44);

      const table = dataSets.map(ds => [ds.datum, ds.name, ds.schule, ds.km]);
      doc.autoTable({
        head: [["Datum", "Name", "Ort", "KM"]],
        body: table,
        startY: 54
      });

      const pageWidth = doc.internal.pageSize.getWidth();
      doc.text("Bereichslehrkraft - Unterschrift:", pageWidth / 2, doc.lastAutoTable.finalY + 20, { align: "center" });

      doc.save(`fahrtkosten_${monat}.pdf`);
      document.getElementById("exportDialogKm").style.display = "none";
    });

    loadData();
  </script>
</body>
</html>
