<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Datenverwaltung - Bereichslehrkräfte Köln</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <h2>Datenverwaltung - Bereichslehrkräfte Köln</h2>

  <form id="dataForm">
    <label>Datum: <input type="date" id="datum" required></label><br>
    <label>Name: <input type="text" id="name" required></label><br>
    <label>Ort: <input type="text" id="schule" required></label><br>
    <label>Unterstützungsmaßnahmen: <input type="text" id="tatigkeit" required></label><br>
    <label>Anmerkungen: <input type="text" id="anmerkungen"></label><br>
    <label>Zeit (h): <input type="number" id="zeit" step="0.1" required></label><br>
    <label>Kilometer: <input type="number" id="km" step="0.1" required></label><br>
    <button type="submit">Speichern</button>
  </form>

  <h3>Gespeicherte Datensätze</h3>
  <table border="1" id="dataTable">
    <thead>
      <tr>
        <th>Datum</th><th>Name</th><th>Ort</th><th>Tätigkeit</th><th>Anmerkungen</th><th>Zeit</th><th>KM</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <button id="exportZeit">Als PDF exportieren (Tätigkeitsbericht)</button>
  <button id="exportKm">Als PDF exportieren (Fahrtkostenabrechnung)</button>

  <script>
    const form = document.getElementById("dataForm");
    const tableBody = document.getElementById("tableBody");
    let dataSets = [];

    // ---------- Laden & Speichern ----------
    function loadData() {
      const saved = localStorage.getItem("dataSets");
      if (saved) dataSets = JSON.parse(saved);
      renderTable();
    }

    function saveData() {
      localStorage.setItem("dataSets", JSON.stringify(dataSets));
    }

    // ---------- Tabelle ----------
    function renderTable() {
      tableBody.innerHTML = "";
      dataSets.forEach(ds => {
        const row = `<tr>
          <td>${ds.datum}</td>
          <td>${ds.name}</td>
          <td>${ds.schule}</td>
          <td>${ds.tatigkeit}</td>
          <td>${ds.anmerkungen}</td>
          <td>${ds.zeit}</td>
          <td>${ds.km}</td>
        </tr>`;
        tableBody.insertAdjacentHTML("beforeend", row);
      });
    }

    form.addEventListener("submit", e => {
      e.preventDefault();
      const newData = {
        datum: document.getElementById("datum").value,
        name: document.getElementById("name").value,
        schule: document.getElementById("schule").value,
        tatigkeit: document.getElementById("tatigkeit").value,
        anmerkungen: document.getElementById("anmerkungen").value,
        zeit: document.getElementById("zeit").value,
        km: document.getElementById("km").value,
      };
      dataSets.push(newData);
      saveData();
      renderTable();
      form.reset();
    });

    // ---------- PDF Export ----------
    document.getElementById("exportZeit").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Titel + Monat
      doc.setFontSize(14);
      doc.text("Berichtsdokument für Bereichslehrkräfte für reisende Kinder und Jugendliche", 14, 20);
      const monat = new Date().toLocaleString("de-DE", { month: "long", year: "numeric" });
      doc.text(`Monat: ${monat}`, 14, 28);

      // Tabelle
      const table = dataSets.map(ds => [ds.datum, ds.name, ds.schule, ds.tatigkeit, ds.zeit]);
      doc.autoTable({
        head: [["Datum", "Name", "Ort", "Tätigkeit", "Zeit (h)"]],
        body: table,
        startY: 38
      });

      // Unterschrift mittig
      const pageWidth = doc.internal.pageSize.getWidth();
      doc.text("Bereichslehrkraft - Unterschrift:", pageWidth / 2, doc.lastAutoTable.finalY + 20, { align: "center" });

      doc.save("taetigkeitsbericht.pdf");
    });

    document.getElementById("exportKm").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Titel + Monat
      doc.setFontSize(14);
      doc.text("Fahrtkostenabrechnung - Bereichslehrkräfte", 14, 20);
      const monat = new Date().toLocaleString("de-DE", { month: "long", year: "numeric" });
      doc.text(`Monat: ${monat}`, 14, 28);

      // Tabelle
      const table = dataSets.map(ds => [ds.datum, ds.name, ds.schule, ds.km]);
      doc.autoTable({
        head: [["Datum", "Name", "Ort", "KM"]],
        body: table,
        startY: 38
      });

      // Unterschrift mittig
      const pageWidth = doc.internal.pageSize.getWidth();
      doc.text("Bereichslehrkraft - Unterschrift:", pageWidth / 2, doc.lastAutoTable.finalY + 20, { align: "center" });

      doc.save("fahrtkosten.pdf");
    });

    loadData();
  </script>
</body>
</html>

